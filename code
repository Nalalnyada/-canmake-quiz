import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { motion } from "framer-motion";

const sparkleSound = typeof Audio !== "undefined" ? new Audio("/sparkle.mp3") : null;

const energies = [
  {
    id: "siren",
    name: "‡∏û‡∏•‡∏±‡∏á‡πÑ‡∏ã‡πÄ‡∏£‡∏ô ‚ú®",
    image: "/siren.png",
    description:
      "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏ã‡πÄ‡∏£‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏≤‡∏Å‡πÄ‡∏™‡∏ô‡πà‡∏´‡πå‡πÅ‡∏´‡πà‡∏á‡∏ó‡πâ‡∏≠‡∏á‡∏ó‡∏∞‡πÄ‡∏• üåä ‡∏™‡∏á‡πà‡∏≤‡∏á‡∏≤‡∏° ‡∏°‡∏µ‡πÄ‡∏™‡∏ô‡πà‡∏´‡πå‡πÄ‡∏¢‡πâ‡∏≤‡∏¢‡∏ß‡∏ô‡πÉ‡∏à ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏ô‡∏ï‡∏£‡πå‡πÄ‡∏™‡∏ô‡πà‡∏´‡πå‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏¢‡∏ï‡∏≤",
    items: ["Canmake Mermaid Skin Gel UV", "Silky Souffle Eyes", "Stay-On Balm Rouge"]
  },
  {
    id: "fairy",
    name: "‡∏û‡∏•‡∏±‡∏á‡∏ô‡∏≤‡∏á‡∏ü‡πâ‡∏≤ üßö",
    image: "/fairy.png",
    description:
      "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ô‡∏≤‡∏á‡∏ü‡πâ‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏ú‡∏π‡πâ‡πÅ‡∏™‡∏ô‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô ‡∏™‡∏î‡πÉ‡∏™ ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏´‡πà‡∏á‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ ‚ú® ‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡πá‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÉ‡∏à‡∏ü‡∏π!",
    items: ["Canmake Cream Cheek", "Perfect Multi Eyes", "Marshmallow Finish Powder"]
  },
  {
    id: "blackcat",
    name: "‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏°‡∏ß‡∏î‡∏≥ üêà‚Äç‚¨õ",
    image: "/blackcat.png",
    description:
      "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏°‡∏ß‡∏î‡∏≥‡∏ú‡∏π‡πâ‡∏•‡∏∂‡∏Å‡∏•‡∏±‡∏ö ‡∏Ç‡∏µ‡πâ‡πÄ‡∏•‡πà‡∏ô ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÄ‡∏™‡∏ô‡πà‡∏´‡πå‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πà‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‚ú® ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡∏≠‡∏î‡πÄ‡∏´‡∏•‡∏µ‡∏¢‡∏ß‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ!",
    items: ["Canmake Creamy Touch Liner", "Quick Lash Curler", "Shading Powder"]
  },
  {
    id: "unicorn",
    name: "‡∏û‡∏•‡∏±‡∏á‡∏¢‡∏π‡∏ô‡∏¥‡∏Ñ‡∏≠‡∏£‡πå‡∏ô ü¶Ñ",
    image: "/unicorn.png",
    description:
      "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏¢‡∏π‡∏ô‡∏¥‡∏Ñ‡∏≠‡∏£‡πå‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏≠‡∏¥‡∏™‡∏£‡∏∞ ‡∏°‡∏µ‡∏à‡∏¥‡∏ô‡∏ï‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏á ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏Ñ‡∏£ üåà ‡πÇ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏µ‡∏™‡∏±‡∏ô",
    items: ["Glow Fleur Cheeks", "Perfect Stylist Eyes", "Stay-On Balm Rouge"]
  },
  {
    id: "dragon",
    name: "‡∏û‡∏•‡∏±‡∏á‡∏°‡∏±‡∏á‡∏Å‡∏£ üî•",
    image: "/dragon.png",
    description:
      "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏°‡∏±‡∏á‡∏Å‡∏£‡∏ú‡∏π‡πâ‡∏Å‡∏•‡πâ‡∏≤‡πÅ‡∏Å‡∏£‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏á‡πà‡∏≤‡∏á‡∏≤‡∏° ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏£‡∏á‡∏Å‡∏•‡∏±‡∏ß‡∏ï‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ üêâ ‡∏ó‡∏∏‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏•‡∏±‡∏á",
    items: ["Marshmallow Finish Powder", "Mix Eyebrow", "Color Mixing Concealer"]
  }
];

const questions = [
  // (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
];

export default function CanmakeQuiz() {
  const [step, setStep] = useState(0);
  const [answers, setAnswers] = useState([]);
  const [result, setResult] = useState(null);
  const [showShare, setShowShare] = useState(false);

  const startQuiz = () => setStep(1);

  const handleAnswer = (value) => {
    const newAnswers = [...answers, value];
    if (newAnswers.length >= questions.length) {
      const counts = newAnswers.reduce((acc, val) => {
        acc[val] = (acc[val] || 0) + 1;
        return acc;
      }, {});
      const max = Object.entries(counts).sort((a, b) => b[1] - a[1])[0][0];
      const found = energies.find((e) => e.id === max);
      setResult(found);
      setStep(2);
      sparkleSound?.play();
      setTimeout(() => setShowShare(true), 1500);
    } else {
      setAnswers(newAnswers);
    }
  };

  const currentQuestion = questions[answers.length];

  return (
    <div className="min-h-screen bg-pink-50 flex flex-col items-center justify-center text-center p-4">
      {step === 0 && (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="space-y-4">
          <h1 className="text-3xl font-bold">üîÆ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏ü‡∏ô‡∏ï‡∏≤‡∏ã‡∏µ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∏‡∏ì!</h1>
          <p className="text-lg">‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡∏î‡∏π‡∏Å‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô ‚ú®</p>
          <Button onClick={startQuiz} className="rounded-2xl px-6 py-2 text-lg bg-pink-400 hover:bg-pink-500">
            ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢ üíñ
          </Button>
        </motion.div>
      )}

      {step === 1 && currentQuestion && (
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="space-y-4 max-w-md">
          <h2 className="text-xl font-semibold">{currentQuestion.text}</h2>
          <div className="grid grid-cols-1 gap-2">
            {currentQuestion.options.map((opt, idx) => (
              <Button key={idx} variant="outline" onClick={() => handleAnswer(opt.value)}>
                {opt.label}
              </Button>
            ))}
          </div>
        </motion.div>
      )}

      {step === 2 && result && (
        <motion.div
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ duration: 0.8 }}
          className="max-w-md space-y-4 relative"
        >
          <h2 className="text-2xl font-bold text-pink-600 animate-bounce">üéâ ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠... {result.name}</h2>
          <img src={result.image} alt={result.name} className="w-48 mx-auto rounded-2xl shadow-md animate-pulse" />
          <p className="text-lg">{result.description}</p>

          <Card className="bg-white/70 backdrop-blur shadow-lg">
            <CardContent className="space-y-2 p-4">
              <h3 className="font-semibold text-pink-500">üß¥ ‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å Canmake:</h3>
              <ul className="list-disc list-inside text-left">
                {result.items.map((item, i) => (
                  <li key={i}>üíÑ {item}</li>
                ))}
              </ul>
            </CardContent>
          </Card>

          {showShare && (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              className="mt-4 space-y-2"
            >
              <p className="text-pink-500 font-medium">‡πÅ‡∏ä‡∏£‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢! üåü</p>
              <div className="flex justify-center gap-4">
                <Button variant="outline" onClick={() => navigator.share?.({
                  title: `‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠ ${result.name}! ‚ú®`,
                  text: result.description,
                  url: window.location.href
                })}>üì≤ ‡πÅ‡∏ä‡∏£‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</Button>
                <Button variant="secondary" onClick={() => navigator.clipboard.writeText(window.location.href)}>
                  üîó ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå
                </Button>
              </div>
            </motion.div>
          )}
        </motion.div>
      )}
    </div>
  );
}
